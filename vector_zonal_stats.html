<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="generate vector zonal stat features">

<title>geowrangler2 - Vector Zonal Stats</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="geowrangler2 - Vector Zonal Stats">
<meta property="og:description" content="generate vector zonal stat features">
<meta property="og:image" content="https://butchtm.github.io/geowrangler2/02_vector_zonal_stats_files/figure-html/cell-33-output-1.png">
<meta property="og:site-name" content="geowrangler2">
<meta property="og:image:height" content="283">
<meta property="og:image:width" content="547">
<meta name="twitter:title" content="geowrangler2 - Vector Zonal Stats">
<meta name="twitter:description" content="generate vector zonal stat features">
<meta name="twitter:image" content="https://butchtm.github.io/geowrangler2/02_vector_zonal_stats_files/figure-html/cell-33-output-1.png">
<meta name="twitter:image-height" content="283">
<meta name="twitter:image-width" content="547">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">geowrangler2</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./vector_zonal_stats.html">Vector Zonal Stats</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geowrangler</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sample Core</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.grids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grid Generation Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.geometry_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geometry Validation Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.vector_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.raster_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.area_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Area Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.distance_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Distance Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.dhs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DHS Wealth Index</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Download</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.spatialjoin_highest_intersection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Join Using Highest Intersection Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.tile_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Clustering Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.raster_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Processing Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Use Case Demos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.poverty_mapping_demo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explore Poverty Mapping Machine Learning Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.usecase_ookla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exploring Internet Speeds with Ookla</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grids</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geometry Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector_zonal_stats.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Vector Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./area_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Area Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector_to_raster_mask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector to Raster mask</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster_to_dataframe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster to Dataframe</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Processing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dhs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DHS Utilities</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_geofabrik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Geofabrik</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_ookla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Ookla</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_nightlights.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Night Lights</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Utils</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tile_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatialjoin_highest_intersection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Join Highest Intersection</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#aggregations" id="toc-aggregations" class="nav-link active" data-scroll-target="#aggregations">Aggregations</a></li>
  <li><a href="#regular-and-grid-zonal-stats" id="toc-regular-and-grid-zonal-stats" class="nav-link" data-scroll-target="#regular-and-grid-zonal-stats">Regular and Grid Zonal Stats</a></li>
  <li><a href="#create_zonal_stats" id="toc-create_zonal_stats" class="nav-link" data-scroll-target="#create_zonal_stats">create_zonal_stats</a></li>
  <li><a href="#bing-map-tile-grid-zonal-stats" id="toc-bing-map-tile-grid-zonal-stats" class="nav-link" data-scroll-target="#bing-map-tile-grid-zonal-stats">Bing Map Tile Grid Zonal Stats</a></li>
  <li><a href="#compute_quadkey" id="toc-compute_quadkey" class="nav-link" data-scroll-target="#compute_quadkey">compute_quadkey</a></li>
  <li><a href="#create_bingtile_zonal_stats" id="toc-create_bingtile_zonal_stats" class="nav-link" data-scroll-target="#create_bingtile_zonal_stats">create_bingtile_zonal_stats</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/butchtm/geowrangler2/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Vector Zonal Stats</h1>
</div>

<div>
  <div class="description">
    generate vector zonal stat features
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="aggregations" class="level3">
<h3 class="anchored" data-anchor-id="aggregations">Aggregations</h3>
<p>In order to generate zonal stats for an area (or areas) of interest (aoi) , we have come up with the concept of an <strong>aggregation specification</strong> or <em>agg spec</em>, which is a way to specify what aggregation functions (such as <code>count</code>,<code>sum</code>, <code>mean</code>,<code>std</code> etc.) are to be applied to columns in the source dataframe (data).</p>
<p>The method <a href="https://butchtm.github.io/geowrangler2/vector_zonal_stats.html#create_zonal_stats"><code>create_zonal_stats</code></a> can then take in a list of these <em>agg specs</em> and apply them to create zonal stats from the data for the aoi.</p>
<p>Each <em>agg spec</em> consists of a <code>dict</code> with the following keys:</p>
<ul>
<li><p><code>func</code>: (Required) a <code>str</code> or a list <code>[str]</code> of aggregation functions. See the pandas documentation for <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html">agg</a></p></li>
<li><p><code>column</code>: (Optional) an existing column in the data to generate the zonal statistic from. If not specified, the grouping key based on the index of the aoi applied to the data is used as default.</p></li>
<li><p><code>output</code>: (Optional) a <code>str</code> or a list <code>[str]</code> of the name(s) of the output zonal statistic column. If not specified it is concatenated from the column and func i.e.&nbsp;<code>{column}_{func}</code> (e.g.&nbsp;<code>'func':'mean'</code> on <code>'column':'population'</code> has a default value <code>'output':'population_mean'</code>)</p></li>
<li><p><code>fillna</code>: (Optional) a <code>bool</code> or a list <code>[bool]</code> of the flag(s) that indicates whether to to a <code>fillna(0)</code> step for the new zonal column, <code>True</code> meaning it will set any <code>NA</code> values in the resulting zonal stat to <code>0</code>, and <code>False</code> will retain any <code>NA</code> values. The default value of the flag(s) is <code>False</code>.</p></li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>The simplest aggregation spec. This will result in an output column named <code>index_count</code> as it will use the aoi index as the default column.</li>
</ul>
<pre><code>{"func":"count"}</code></pre>
<ul>
<li>The <code>sum</code> function is applied to the data column <code>population</code> which will create an output column named <code>total_population</code>.</li>
</ul>
<pre><code>{
 "func:"sum",
 "column": "population",
 "output": "total_population"
}</code></pre>
<ul>
<li>Compute the zonal stats <code>mean</code>,<code>sum</code>,<code>max</code> on the <code>population</code> column and rename the output columns (by default) to <code>population_mean</code>, <code>population_sum</code> and <code>population_max</code>.</li>
</ul>
<pre><code>{
 "func": ["mean","sum","max"],
 "column": "population",
}</code></pre>
<ul>
<li>A full aggregation spec with <code>fillna</code>. <code>fillna == False</code> for <code>std</code> means it will remain an <code>NA</code> if there is no data for the column in the group. The default value for <code>fillna</code> is <code>True</code> which means that <code>0</code> is used to replace any <code>NA</code> in the output column.</li>
</ul>
<pre><code>{
 "func": ["mean", "sum", "std"],
 "column":"population",
 "output": ["avg_pop", "total_pop", "std_dev"],
 "fillna": [True,True,False],
}</code></pre>
<p>The <code>agg spec</code> in the list of aggregations can contain the same columns, but the output columns must be unique since they will added as columns in the results.</p>
</section>
<section id="regular-and-grid-zonal-stats" class="level3">
<h3 class="anchored" data-anchor-id="regular-and-grid-zonal-stats">Regular and Grid Zonal Stats</h3>
<blockquote class="blockquote">
<p>Vector zonal stats for user defined areas and grids (e.g.&nbsp;Admin areas)</p>
</blockquote>
<hr>
<p><a href="https://github.com/butchtm/geowrangler2/blob/main/geowrangler2/vector_zonal_stats.py#L203" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="create_zonal_stats" class="level3">
<h3 class="anchored" data-anchor-id="create_zonal_stats">create_zonal_stats</h3>
<blockquote class="blockquote">
<pre><code> create_zonal_stats (aoi:geopandas.geodataframe.GeoDataFrame,
                     data:geopandas.geodataframe.GeoDataFrame,
                     aggregations:List[Dict[str,Any]],
                     overlap_method:str='intersects')</code></pre>
</blockquote>
<p>Create zonal stats for area of interest from data using aggregration operations on data columns. Returns the same aoi with additional columns containing the computed zonal features.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>aoi</td>
<td>GeoDataFrame</td>
<td></td>
<td>Area of interest for which zonal stats are to be computed for</td>
</tr>
<tr class="even">
<td>data</td>
<td>GeoDataFrame</td>
<td></td>
<td>Source gdf containing data to compute zonal stats from</td>
</tr>
<tr class="odd">
<td>aggregations</td>
<td>typing.List[typing.Dict[str, typing.Any]]</td>
<td></td>
<td>List of agg specs, with each agg spec applied to a data column</td>
</tr>
<tr class="even">
<td>overlap_method</td>
<td>str</td>
<td>intersects</td>
<td>spatial predicate to used in spatial join of aoi and data <a href="https://geopandas.org/en/stable/docs/user_guide/mergingdata.html#binary-predicate-joins">geopandas.sjoin</a> for more details</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>GeoDataFrame</strong></td>
<td></td>
<td><strong>categorical_column_options: str = None,</strong></td>
</tr>
</tbody>
</table>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>simple_aoi  <span class="co"># sample aoi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">col1</th>
<th data-quarto-table-cell-role="th">lat0</th>
<th data-quarto-table-cell-role="th">lon0</th>
<th data-quarto-table-cell-role="th">lat1</th>
<th data-quarto-table-cell-role="th">lon1</th>
<th data-quarto-table-cell-role="th">lat2</th>
<th data-quarto-table-cell-role="th">lon2</th>
<th data-quarto-table-cell-role="th">lat3</th>
<th data-quarto-table-cell-role="th">lon3</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>POLYGON ((0.00000 0.00000, 0.00000 1.00000, 1....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>POLYGON ((1.00000 0.00000, 1.00000 1.00000, 2....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>POLYGON ((2.00000 0.00000, 2.00000 1.00000, 3....</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>simple_data  <span class="co"># sample data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">col1</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.50</td>
<td>0.50</td>
<td>POINT (0.50000 0.50000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.50</td>
<td>0.50</td>
<td>POINT (1.50000 0.50000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.50</td>
<td>0.50</td>
<td>POINT (2.50000 0.50000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>0.45</td>
<td>0.50</td>
<td>POINT (0.45000 0.50000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>1.45</td>
<td>0.50</td>
<td>POINT (1.45000 0.50000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>2.45</td>
<td>0.50</td>
<td>POINT (2.45000 0.50000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>0.45</td>
<td>0.45</td>
<td>POINT (0.45000 0.45000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>1.45</td>
<td>0.45</td>
<td>POINT (1.45000 0.45000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>2.45</td>
<td>0.45</td>
<td>POINT (2.45000 0.45000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>0.45</td>
<td>1.45</td>
<td>POINT (0.45000 1.45000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>11</td>
<td>1.45</td>
<td>1.45</td>
<td>POINT (1.45000 1.45000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>12</td>
<td>2.45</td>
<td>1.45</td>
<td>POINT (2.45000 1.45000)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-jupyter="{&quot;source_hidden&quot;:true}" data-tags="[]" data-execution_count="44">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> simple_aoi.plot(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>plt.axes(), facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span>[<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> simple_data.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02_vector_zonal_stats_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> create_zonal_stats(simple_aoi, simple_data, aggregations<span class="op">=</span>[{<span class="st">"func"</span>: <span class="st">"count"</span>}])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">col1</th>
<th data-quarto-table-cell-role="th">lat0</th>
<th data-quarto-table-cell-role="th">lon0</th>
<th data-quarto-table-cell-role="th">lat1</th>
<th data-quarto-table-cell-role="th">lon1</th>
<th data-quarto-table-cell-role="th">lat2</th>
<th data-quarto-table-cell-role="th">lon2</th>
<th data-quarto-table-cell-role="th">lat3</th>
<th data-quarto-table-cell-role="th">lon3</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>POLYGON ((0.00000 0.00000, 0.00000 1.00000, 1....</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>POLYGON ((1.00000 0.00000, 1.00000 1.00000, 2....</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>POLYGON ((2.00000 0.00000, 2.00000 1.00000, 3....</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Index name is not none</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>named_index_aoi <span class="op">=</span> simple_aoi.copy()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>named_index_aoi.index.name <span class="op">=</span> <span class="st">"myindex"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>named_index_aoi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">col1</th>
<th data-quarto-table-cell-role="th">lat0</th>
<th data-quarto-table-cell-role="th">lon0</th>
<th data-quarto-table-cell-role="th">lat1</th>
<th data-quarto-table-cell-role="th">lon1</th>
<th data-quarto-table-cell-role="th">lat2</th>
<th data-quarto-table-cell-role="th">lon2</th>
<th data-quarto-table-cell-role="th">lat3</th>
<th data-quarto-table-cell-role="th">lon3</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">myindex</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>POLYGON ((0.00000 0.00000, 0.00000 1.00000, 1....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>POLYGON ((1.00000 0.00000, 1.00000 1.00000, 2....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>POLYGON ((2.00000 0.00000, 2.00000 1.00000, 3....</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>named_index_results <span class="op">=</span> create_zonal_stats(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    named_index_aoi, simple_data, aggregations<span class="op">=</span>[{<span class="st">"func"</span>: <span class="st">"count"</span>}]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>named_index_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">col1</th>
<th data-quarto-table-cell-role="th">lat0</th>
<th data-quarto-table-cell-role="th">lon0</th>
<th data-quarto-table-cell-role="th">lat1</th>
<th data-quarto-table-cell-role="th">lon1</th>
<th data-quarto-table-cell-role="th">lat2</th>
<th data-quarto-table-cell-role="th">lon2</th>
<th data-quarto-table-cell-role="th">lat3</th>
<th data-quarto-table-cell-role="th">lon3</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">myindex</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>POLYGON ((0.00000 0.00000, 0.00000 1.00000, 1....</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>POLYGON ((1.00000 0.00000, 1.00000 1.00000, 2....</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>0.0</td>
<td>POLYGON ((2.00000 0.00000, 2.00000 1.00000, 3....</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="bing-map-tile-grid-zonal-stats" class="level3">
<h3 class="anchored" data-anchor-id="bing-map-tile-grid-zonal-stats">Bing Map Tile Grid Zonal Stats</h3>
<blockquote class="blockquote">
<p>Generating zonal stats for Bing tile grid AOIs</p>
</blockquote>
<hr>
<p><a href="https://github.com/butchtm/geowrangler2/blob/main/geowrangler2/vector_zonal_stats.py#L254" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="compute_quadkey" class="level3">
<h3 class="anchored" data-anchor-id="compute_quadkey">compute_quadkey</h3>
<blockquote class="blockquote">
<pre><code> compute_quadkey (data:geopandas.geodataframe.GeoDataFrame,
                  zoom_level:int, inplace:bool=False,
                  quadkey_column:str='quadkey')</code></pre>
</blockquote>
<p>Computes the quadkeys for the geometries of the data. If geometries are not points, the quadkeys are computed from the centroids of the geometries.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>data</td>
<td>GeoDataFrame</td>
<td></td>
<td>The geodataframe</td>
</tr>
<tr class="even">
<td>zoom_level</td>
<td>int</td>
<td></td>
<td>The quadkey zoom level (1-23)</td>
</tr>
<tr class="odd">
<td>inplace</td>
<td>bool</td>
<td>False</td>
<td>Whether to change data inplace or not</td>
</tr>
<tr class="even">
<td>quadkey_column</td>
<td>str</td>
<td>quadkey</td>
<td>The name of the quadkey output column</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>GeoDataFrame</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>If our existing data geodataframe doesn’t have quadkeys, we can use the <a href="https://butchtm.github.io/geowrangler2/vector_zonal_stats.html#compute_quadkey"><code>compute_quadkey</code></a> to generate the quadkeys for the centroid of the data’s geometries.</p>
<div class="cell" data-tags="[]" data-execution_count="60">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>DATA_ZOOM_LEVEL <span class="op">=</span> <span class="dv">19</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>AOI_ZOOM_LEVEL <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>simple_data_quadkey <span class="op">=</span> compute_quadkey(simple_data, DATA_ZOOM_LEVEL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 102 ms, sys: 21.4 ms, total: 124 ms
Wall time: 129 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>simple_data_quadkey.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">col1</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">quadkey</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.50</td>
<td>0.5</td>
<td>POINT (0.50000 0.50000)</td>
<td>1222222221211211222</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1.50</td>
<td>0.5</td>
<td>POINT (1.50000 0.50000)</td>
<td>1222222320210201222</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2.50</td>
<td>0.5</td>
<td>POINT (2.50000 0.50000)</td>
<td>1222222331200311222</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>0.45</td>
<td>0.5</td>
<td>POINT (0.45000 0.50000)</td>
<td>1222222221210201333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>1.45</td>
<td>0.5</td>
<td>POINT (1.45000 0.50000)</td>
<td>1222222320200311333</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p><a href="https://github.com/butchtm/geowrangler2/blob/main/geowrangler2/vector_zonal_stats.py#L310" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="create_bingtile_zonal_stats" class="level3">
<h3 class="anchored" data-anchor-id="create_bingtile_zonal_stats">create_bingtile_zonal_stats</h3>
<blockquote class="blockquote">
<pre><code> create_bingtile_zonal_stats (aoi:pandas.core.frame.DataFrame,
                              data:pandas.core.frame.DataFrame,
                              aggregations:List[Dict[str,Any]],
                              aoi_quadkey_column:str='quadkey',
                              data_quadkey_column:str='quadkey')</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>aoi</td>
<td>DataFrame</td>
<td></td>
<td>An aoi with quadkey column</td>
</tr>
<tr class="even">
<td>data</td>
<td>DataFrame</td>
<td></td>
<td>Data with quadkey column</td>
</tr>
<tr class="odd">
<td>aggregations</td>
<td>typing.List[typing.Dict[str, typing.Any]]</td>
<td></td>
<td>List of agg specs, with each agg spec applied to a data column</td>
</tr>
<tr class="even">
<td>aoi_quadkey_column</td>
<td>str</td>
<td>quadkey</td>
<td>Column name of aoi quadkey</td>
</tr>
<tr class="odd">
<td>data_quadkey_column</td>
<td>str</td>
<td>quadkey</td>
<td>Column name of data quadkey</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>DataFrame</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>To create bingtile zonal stats, we need to compute the quadkeys for the areas of interest (AOI) and the data.</p>
<p>The <code>geowrangler2.grids</code> module provides a <a href="https://butchtm.github.io/geowrangler2/grids.html#bingtilegridgenerator"><code>BingTileGridGenerator</code></a> that will generate the quadkeys for the areas covered by your AOIs.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geowrangler2.grids <span class="im">as</span> gr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bgtile_generator <span class="op">=</span> gr.BingTileGridGenerator(AOI_ZOOM_LEVEL)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>simple_aoi_bingtiles <span class="op">=</span> bgtile_generator.generate_grid(simple_aoi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the data with the computed quadkeys, we can generate zonal stats for our bingtile grid aois. This just uses the regular pandas grouping and merging function and skips any geospatial joins which results in faster computation.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bingtile_results <span class="op">=</span> create_bingtile_zonal_stats(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    simple_aoi_bingtiles,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    simple_data_quadkey,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    aggregations<span class="op">=</span>[<span class="bu">dict</span>(func<span class="op">=</span><span class="st">"count"</span>, fillna<span class="op">=</span><span class="va">True</span>)],</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 65.4 ms, sys: 8.03 ms, total: 73.4 ms
Wall time: 71.1 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bingtile_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">quadkey</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>122222220</td>
<td>POLYGON ((-0.00000 0.70311, -0.00000 1.40611, ...</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>122222221</td>
<td>POLYGON ((0.70312 0.70311, 0.70312 1.40611, 1....</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>122222230</td>
<td>POLYGON ((1.40625 0.70311, 1.40625 1.40611, 2....</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>122222231</td>
<td>POLYGON ((2.10937 0.70311, 2.10937 1.40611, 2....</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>122222320</td>
<td>POLYGON ((2.81250 0.70311, 2.81250 1.40611, 3....</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>122222222</td>
<td>POLYGON ((-0.00000 0.00000, -0.00000 0.70311, ...</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>122222223</td>
<td>POLYGON ((0.70312 0.00000, 0.70312 0.70311, 1....</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>122222232</td>
<td>POLYGON ((1.40625 0.00000, 1.40625 0.70311, 2....</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>122222233</td>
<td>POLYGON ((2.10937 0.00000, 2.10937 0.70311, 2....</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>122222322</td>
<td>POLYGON ((2.81250 0.00000, 2.81250 0.70311, 3....</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can also use any bingtile grid for any zoom level lower than the data’s zoom level</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bgtile_generator10 <span class="op">=</span> gr.BingTileGridGenerator(AOI_ZOOM_LEVEL <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>simple_aoi_bingtiles10 <span class="op">=</span> bgtile_generator10.generate_grid(simple_aoi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bingtile_results10 <span class="op">=</span> create_bingtile_zonal_stats(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    simple_aoi_bingtiles10,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    simple_data_quadkey,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    aggregations<span class="op">=</span>[<span class="bu">dict</span>(func<span class="op">=</span><span class="st">"count"</span>, fillna<span class="op">=</span><span class="va">True</span>)],</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bingtile_results10[bingtile_results10.index_count <span class="op">&gt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">quadkey</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1222222221</td>
<td>POLYGON ((0.35156 0.35156, 0.35156 0.70311, 0....</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>1222222320</td>
<td>POLYGON ((1.40625 0.35156, 1.40625 0.70311, 1....</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>1222222330</td>
<td>POLYGON ((2.10937 0.35156, 2.10937 0.70311, 2....</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>1222222331</td>
<td>POLYGON ((2.46094 0.35156, 2.46094 0.70311, 2....</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="82">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> results.plot(ax<span class="op">=</span>plt.axes(), column<span class="op">=</span><span class="st">"index_count"</span>, edgecolor<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> simple_data.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"purple"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> bingtile_results.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">"index_count"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> bingtile_results10.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">"index_count"</span>, edgecolor<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="02_vector_zonal_stats_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://thinkingmachin.es">Copyright 2023 onwards, Thinking Machines Data Science Inc.</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center"><a href="https://thinkingmachin.es"><img src="images/company_logo_sm.png" class="img-fluid" alt="Thinking Machines Data Science Inc." width="65"></a></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/butchtm/geowrangler2">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>