<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>geowrangler2 - Exploring Internet Speeds with Ookla</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="geowrangler2 - Exploring Internet Speeds with Ookla">
<meta property="og:description" content="">
<meta property="og:image" content="https://butchtm.github.io/geowrangler2/overview.usecase_ookla_files/figure-html/cell-21-output-1.png">
<meta property="og:site-name" content="geowrangler2">
<meta property="og:image:height" content="249">
<meta property="og:image:width" content="154">
<meta name="twitter:title" content="geowrangler2 - Exploring Internet Speeds with Ookla">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://butchtm.github.io/geowrangler2/overview.usecase_ookla_files/figure-html/cell-21-output-1.png">
<meta name="twitter:image-height" content="249">
<meta name="twitter:image-width" content="154">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">geowrangler2</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./overview.poverty_mapping_demo.html">Use Case Demos</a></li><li class="breadcrumb-item"><a href="./overview.usecase_ookla.html">Exploring Internet Speeds with Ookla</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geowrangler</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sample Core</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.grids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grid Generation Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.geometry_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geometry Validation Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.vector_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.raster_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.area_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Area Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.distance_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Distance Zonal Stats Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.dhs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DHS Wealth Index</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Download</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.spatialjoin_highest_intersection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Join Using Highest Intersection Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.tile_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Clustering Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tutorial.raster_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Processing Tutorial</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Use Case Demos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.poverty_mapping_demo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explore Poverty Mapping Machine Learning Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overview.usecase_ookla.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Exploring Internet Speeds with Ookla</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grids</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geometry Validation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./area_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Area Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distance_zonal_stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distance Zonal Stats</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vector_to_raster_mask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vector to Raster mask</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster_to_dataframe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster to Dataframe</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Processing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dhs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DHS Utilities</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_geofabrik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Geofabrik</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_ookla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Ookla</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_nightlights.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Night Lights</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets Utils</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tile_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tile Clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatialjoin_highest_intersection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Join Highest Intersection</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#how-geowrangler2-can-make-this-process-easier" id="toc-how-geowrangler2-can-make-this-process-easier" class="nav-link" data-scroll-target="#how-geowrangler2-can-make-this-process-easier">How geowrangler2 can make this process easier</a></li>
  <li><a href="#what-you-need-to-do" id="toc-what-you-need-to-do" class="nav-link" data-scroll-target="#what-you-need-to-do">What you need to do</a></li>
  </ul></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a>
  <ul class="collapse">
  <li><a href="#import-libraries" id="toc-import-libraries" class="nav-link" data-scroll-target="#import-libraries">Import libraries</a></li>
  <li><a href="#download-admin-areas" id="toc-download-admin-areas" class="nav-link" data-scroll-target="#download-admin-areas">Download Admin Areas</a></li>
  <li><a href="#download-ookla-data" id="toc-download-ookla-data" class="nav-link" data-scroll-target="#download-ookla-data">Download Ookla data</a></li>
  <li><a href="#convert-ookla-data-into-a-geodataframe" id="toc-convert-ookla-data-into-a-geodataframe" class="nav-link" data-scroll-target="#convert-ookla-data-into-a-geodataframe">Convert ookla data into a GeoDataFrame</a></li>
  <li><a href="#validate-aoi-and-data-geometries" id="toc-validate-aoi-and-data-geometries" class="nav-link" data-scroll-target="#validate-aoi-and-data-geometries">Validate AOI and Data Geometries</a></li>
  <li><a href="#generate-zonal-stats" id="toc-generate-zonal-stats" class="nav-link" data-scroll-target="#generate-zonal-stats">Generate Zonal Stats</a></li>
  <li><a href="#analyze-zonal-stats" id="toc-analyze-zonal-stats" class="nav-link" data-scroll-target="#analyze-zonal-stats">Analyze Zonal Stats</a></li>
  <li><a href="#additional-exercises" id="toc-additional-exercises" class="nav-link" data-scroll-target="#additional-exercises">Additional Exercises</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/butchtm/geowrangler2/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploring Internet Speeds with Ookla</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<blockquote class="blockquote">
<p>A simple use case demo for using geowrangler2 modules to find the Philippine provinces/towns with the slowest/fastest internet speeds.</p>
</blockquote>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This <strong>Use Case Demo</strong> shows how to use the <a href="./datasets_ookla.html"><em>geowrangler2.datasets.ookla</em></a> and the <a href="./area_zonal_stats.html"><em>geowrangler2.area_zonal_stats</em></a> modules to find the slowest/fastest internet speeds within an area or region of interest.</p>
<section id="how-geowrangler2-can-make-this-process-easier" class="level3">
<h3 class="anchored" data-anchor-id="how-geowrangler2-can-make-this-process-easier">How geowrangler2 can make this process easier</h3>
<p>geowrangler2 can:</p>
<ul>
<li>Validate your geodataframes</li>
<li>Help you download Ookla data (internet speed)</li>
<li>Generate zonal stats for your province/town</li>
</ul>
</section>
<section id="what-you-need-to-do" class="level3">
<h3 class="anchored" data-anchor-id="what-you-need-to-do">What you need to do</h3>
<ul>
<li>Get your AOIs (areas of interest) - get the boundaries of your administrative regions</li>
<li>Download ookla data</li>
<li>Validate AOIs and ookla data</li>
<li>Generate zonal Stats</li>
<li>Analyze and find fastest/slowest internet speeds</li>
</ul>
</section>
</section>
<section id="tutorial" class="level2">
<h2 class="anchored" data-anchor-id="tutorial">Tutorial</h2>
<section id="import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries">Import libraries</h3>
<p>Lets start by importing the required libraries</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geowrangler2.area_zonal_stats <span class="im">as</span> azs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-admin-areas" class="level3">
<h3 class="anchored" data-anchor-id="download-admin-areas">Download Admin Areas</h3>
<p>Next, we get the administrative boundaries geodataset using <a href="https://data.humdata.org/dataset/cod-ab-phl">data from Humanitarian Data Exchange</a></p>
<section id="set-region-filter" class="level4">
<h4 class="anchored" data-anchor-id="set-region-filter">Set Region Filter</h4>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>setting the region filter to <code>None</code> will compute the zonal stats for the whole Philippines and can take a lot longer than for a region</p>
</div>
</div>
<p>Set the <strong>REGION_FILTER</strong> to your Region (or <code>None</code> for the whole Philippines)</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># REGION_FILTER = None  # All regions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>REGION_FILTER <span class="op">=</span> <span class="st">"National Capital Region"</span>  <span class="co"># limit to 1 to speed up processing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Download the geodataset containing the admin areas of your country.</p>
<p>Here we are using the data for the Philippines.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no_test</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>phl_admin3_file <span class="op">=</span> <span class="st">"phl_adminboundaries_candidate_adm3"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>phl_admin3_zip <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>phl_admin3_file<span class="sc">}</span><span class="ss">.zip"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># shapefiles</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>phl_admin3_link <span class="op">=</span> <span class="ss">f"https://data.humdata.org/dataset/caf116df-f984-4deb-85ca-41b349d3f313/resource/12457689-6a86-4474-8032-5ca9464d38a8/download/</span><span class="sc">{</span>phl_admin3_zip<span class="sc">}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Download the zipped file. Depending on your internet connection, it can take several minutes.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no_test</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>[ <span class="op">!</span> <span class="op">-</span>e ..<span class="op">/</span>data<span class="op">/</span>{phl_admin3_zip} ] <span class="op">&amp;&amp;</span> curl <span class="op">-</span>L <span class="op">-</span>o ..<span class="op">/</span>data<span class="op">/</span>{phl_admin3_zip} {phl_admin3_link}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 3.9 ms, sys: 12.6 ms, total: 16.5 ms
Wall time: 123 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir <span class="op">-</span>p ..<span class="op">/</span>data<span class="op">/</span>{phl_admin3_file}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>main_file <span class="op">=</span> <span class="st">"phl_admbnda_adm3_psa_namria_20200529"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>phl_admin3_shp <span class="op">=</span> <span class="ss">f"../data/</span><span class="sc">{</span>phl_admin3_file<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>main_file<span class="sc">}</span><span class="ss">.shp"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>[ <span class="op">!</span> <span class="op">-</span>e {phl_admin3_shp} ] <span class="op">&amp;&amp;</span> unzip <span class="op">-</span>d ..<span class="op">/</span>data<span class="op">/</span>{phl_admin3_file} ..<span class="op">/</span>data<span class="op">/</span>{phl_admin3_zip}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 5.08 ms, sys: 3.09 ms, total: 8.17 ms
Wall time: 112 ms</code></pre>
</div>
</div>
<p>Load the admin area geo dataset.</p>
<p>In our example we are loading the <code>.shp</code> or shape file as a geopandas dataframe.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"loading </span><span class="sc">{</span>phl_admin3_shp<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>admin3 <span class="op">=</span> gpd.read_file(phl_admin3_shp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>loading ../data/phl_adminboundaries_candidate_adm3/phl_admbnda_adm3_psa_namria_20200529.shp
CPU times: user 4.4 s, sys: 4.54 s, total: 8.93 s
Wall time: 9.1 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>admin3.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">ADM3_EN</th>
<th data-quarto-table-cell-role="th">ADM3_PCODE</th>
<th data-quarto-table-cell-role="th">ADM3_REF</th>
<th data-quarto-table-cell-role="th">ADM3ALT1EN</th>
<th data-quarto-table-cell-role="th">ADM3ALT2EN</th>
<th data-quarto-table-cell-role="th">ADM2_EN</th>
<th data-quarto-table-cell-role="th">ADM2_PCODE</th>
<th data-quarto-table-cell-role="th">ADM1_EN</th>
<th data-quarto-table-cell-role="th">ADM1_PCODE</th>
<th data-quarto-table-cell-role="th">ADM0_EN</th>
<th data-quarto-table-cell-role="th">ADM0_PCODE</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">validOn</th>
<th data-quarto-table-cell-role="th">validTo</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.601219</td>
<td>0.063496</td>
<td>Aborlan</td>
<td>PH175301000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>Palawan</td>
<td>PH175300000</td>
<td>Region IV-B</td>
<td>PH170000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>MULTIPOLYGON (((118.58350 9.37700, 118.58398 9...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.078749</td>
<td>0.050232</td>
<td>Abra de Ilog</td>
<td>PH175101000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>Occidental Mindoro</td>
<td>PH175100000</td>
<td>Region IV-B</td>
<td>PH170000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((120.58412 13.50198, 120.58420 13.501...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.424301</td>
<td>0.006453</td>
<td>Abucay</td>
<td>PH030801000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>Bataan</td>
<td>PH030800000</td>
<td>Region III</td>
<td>PH030000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((120.49873 14.75614, 120.49891 14.755...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.566053</td>
<td>0.011343</td>
<td>Abulug</td>
<td>PH021501000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>Cagayan</td>
<td>PH021500000</td>
<td>Region II</td>
<td>PH020000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((121.43455 18.46651, 121.43502 18.466...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.013649</td>
<td>0.026124</td>
<td>Abuyog</td>
<td>PH083701000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>Leyte</td>
<td>PH083700000</td>
<td>Region VIII</td>
<td>PH080000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>MULTIPOLYGON (((125.02684 10.73500, 125.02683 ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(admin3.columns.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>['Shape_Leng',
 'Shape_Area',
 'ADM3_EN',
 'ADM3_PCODE',
 'ADM3_REF',
 'ADM3ALT1EN',
 'ADM3ALT2EN',
 'ADM2_EN',
 'ADM2_PCODE',
 'ADM1_EN',
 'ADM1_PCODE',
 'ADM0_EN',
 'ADM0_PCODE',
 'date',
 'validOn',
 'validTo',
 'geometry']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>admin3.ADM1_EN.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array(['Region IV-B', 'Region III', 'Region II', 'Region VIII',
       'Region I', 'Region IV-A', 'Cordillera Administrative Region',
       'Region VI', 'Autonomous Region in Muslim Mindanao', 'Region XII',
       'Region VII', 'Region XIII', 'Region IX', 'Region X', 'Region V',
       'Region XI', 'National Capital Region'], dtype=object)</code></pre>
</div>
</div>
<p>Limit the admin regions to only 1 in order to make the process run faster.</p>
<p>The <strong>REGION FILTER</strong> is set in the <a href="#Set-Region-Filter">Set Region Filter Section</a></p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> REGION_FILTER:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    admin3 <span class="op">=</span> admin3[admin3.ADM1_EN <span class="op">==</span> REGION_FILTER]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> admin3.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="overview.usecase_ookla_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/admin3-ncr.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Admin 3 Levels for NCR</figcaption>
</figure>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> admin3[admin3.ADM3_EN <span class="op">==</span> <span class="st">"Pateros"</span>].plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 115 ms, sys: 92.5 ms, total: 207 ms
Wall time: 105 ms</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="overview.usecase_ookla_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>admin3.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>admin3.total_bounds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>array([120.90639543,  14.35172957, 121.13503641,  14.78529173])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(admin3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>30</code></pre>
</div>
</div>
</section>
</section>
<section id="download-ookla-data" class="level3">
<h3 class="anchored" data-anchor-id="download-ookla-data">Download Ookla data</h3>
<p>Use the <code>geowrangler2.datasets.ookla</code> module to explore and download ookla (internet speed) data</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geowrangler2.datasets <span class="im">import</span> ookla</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>List the publically available ookla datasets</p>
<div class="cell" data-tags="[]" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ookla_dsets <span class="op">=</span> ookla.list_ookla_files()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>ookla_dsets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 76.1 ms, sys: 14.5 ms, total: 90.5 ms
Wall time: 1.13 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>{OoklaQuarter(type='fixed', year='2019', quarter='1'): '2019-01-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2019', quarter='2'): '2019-04-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2019', quarter='3'): '2019-07-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2019', quarter='4'): '2019-10-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2020', quarter='1'): '2020-01-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2020', quarter='2'): '2020-04-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2020', quarter='3'): '2020-07-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2020', quarter='4'): '2020-10-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2021', quarter='1'): '2021-01-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2021', quarter='2'): '2021-04-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2021', quarter='3'): '2021-07-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2021', quarter='4'): '2021-10-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2022', quarter='1'): '2022-01-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='fixed', year='2022', quarter='2'): '2022-04-01_performance_fixed_tiles.parquet',
 OoklaQuarter(type='mobile', year='2019', quarter='1'): '2019-01-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2019', quarter='2'): '2019-04-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2019', quarter='3'): '2019-07-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2019', quarter='4'): '2019-10-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2020', quarter='1'): '2020-01-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2020', quarter='2'): '2020-04-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2020', quarter='3'): '2020-07-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2020', quarter='4'): '2020-10-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2021', quarter='1'): '2021-01-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2021', quarter='2'): '2021-04-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2021', quarter='3'): '2021-07-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2021', quarter='4'): '2021-10-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2022', quarter='1'): '2022-01-01_performance_mobile_tiles.parquet',
 OoklaQuarter(type='mobile', year='2022', quarter='2'): '2022-04-01_performance_mobile_tiles.parquet'}</code></pre>
</div>
</div>
<p>Download the latest data (as of the time of writing this)</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ookla_params <span class="op">=</span> <span class="bu">dict</span>(year<span class="op">=</span><span class="st">"2022"</span>, quarter<span class="op">=</span><span class="st">"2"</span>, directory<span class="op">=</span><span class="st">"../data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ookla_fixed <span class="op">=</span> ookla.download_ookla_file(type_<span class="op">=</span><span class="st">"fixed"</span>, <span class="op">**</span>ookla_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 143 µs, sys: 118 µs, total: 261 µs
Wall time: 182 µs</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ookla_fixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>PosixPath('../data/2022-04-01_performance_fixed_tiles.parquet')</code></pre>
</div>
</div>
</section>
<section id="convert-ookla-data-into-a-geodataframe" class="level3">
<h3 class="anchored" data-anchor-id="convert-ookla-data-into-a-geodataframe">Convert ookla data into a GeoDataFrame</h3>
<p>The downloaded file from ookla is not yet a geodataset, so we will h have to convert it into a <code>GeoDataFrame</code> suitable for use in geowrangler2.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The downloaded ookla data contains the internet speed data for the whole world and can take a minute or two to load.</p>
<p>Later, we will show how to filter the data to only include the data relevant to our AOI.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fixed <span class="op">=</span> pd.read_parquet(ookla_fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 7.72 s, sys: 14.2 s, total: 21.9 s
Wall time: 19.2 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>6581735</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fixed.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">quadkey</th>
<th data-quarto-table-cell-role="th">tile</th>
<th data-quarto-table-cell-role="th">avg_d_kbps</th>
<th data-quarto-table-cell-role="th">avg_u_kbps</th>
<th data-quarto-table-cell-role="th">avg_lat_ms</th>
<th data-quarto-table-cell-role="th">tests</th>
<th data-quarto-table-cell-role="th">devices</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0000122200000000</td>
<td>POLYGON((-168.75 84.1249731939109, -168.744506...</td>
<td>97075</td>
<td>42458</td>
<td>65</td>
<td>7</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0022133222312322</td>
<td>POLYGON((-160.02685546875 70.6435894914449, -1...</td>
<td>8324</td>
<td>3798</td>
<td>91</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0022133222330100</td>
<td>POLYGON((-160.02685546875 70.6417687358462, -1...</td>
<td>14972</td>
<td>4461</td>
<td>94</td>
<td>29</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0022133222330201</td>
<td>POLYGON((-160.043334960938 70.6344840663086, -...</td>
<td>6253</td>
<td>2818</td>
<td>91</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0022202203233313</td>
<td>POLYGON((-179.478149414062 68.9169336615194, -...</td>
<td>700</td>
<td>126</td>
<td>1090</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fixed.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>quadkey       object
tile          object
avg_d_kbps     int64
avg_u_kbps     int64
avg_lat_ms     int64
tests          int64
devices        int64
dtype: object</code></pre>
</div>
</div>
<p>The data is now a Pandas <code>DataFrame</code> but this needs to be converted to a <code>GeoDataFrame</code> by converting the <code>tile</code> column into a <code>geometry</code> with a <code>crs</code> (Coordinate Reference System).</p>
<p>See <a href="https://epsg.io/4326">EPSG:4326</a> for more details about the CRS.</p>
<p>Converting the data can also take a minute or two.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fixed[<span class="st">"geometry"</span>] <span class="op">=</span> gpd.GeoSeries.from_wkt(fixed.tile, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 30.1 s, sys: 1.55 s, total: 31.6 s
Wall time: 31.3 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fixed.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">quadkey</th>
<th data-quarto-table-cell-role="th">tile</th>
<th data-quarto-table-cell-role="th">avg_d_kbps</th>
<th data-quarto-table-cell-role="th">avg_u_kbps</th>
<th data-quarto-table-cell-role="th">avg_lat_ms</th>
<th data-quarto-table-cell-role="th">tests</th>
<th data-quarto-table-cell-role="th">devices</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0000122200000000</td>
<td>POLYGON((-168.75 84.1249731939109, -168.744506...</td>
<td>97075</td>
<td>42458</td>
<td>65</td>
<td>7</td>
<td>1</td>
<td>POLYGON ((-168.75000 84.12497, -168.74451 84.1...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0022133222312322</td>
<td>POLYGON((-160.02685546875 70.6435894914449, -1...</td>
<td>8324</td>
<td>3798</td>
<td>91</td>
<td>2</td>
<td>1</td>
<td>POLYGON ((-160.02686 70.64359, -160.02136 70.6...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0022133222330100</td>
<td>POLYGON((-160.02685546875 70.6417687358462, -1...</td>
<td>14972</td>
<td>4461</td>
<td>94</td>
<td>29</td>
<td>2</td>
<td>POLYGON ((-160.02686 70.64177, -160.02136 70.6...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0022133222330201</td>
<td>POLYGON((-160.043334960938 70.6344840663086, -...</td>
<td>6253</td>
<td>2818</td>
<td>91</td>
<td>1</td>
<td>1</td>
<td>POLYGON ((-160.04333 70.63448, -160.03784 70.6...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0022202203233313</td>
<td>POLYGON((-179.478149414062 68.9169336615194, -...</td>
<td>700</td>
<td>126</td>
<td>1090</td>
<td>1</td>
<td>1</td>
<td>POLYGON ((-179.47815 68.91693, -179.47266 68.9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fixed.drop(columns<span class="op">=</span>[<span class="st">"tile"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 515 ms, sys: 95.8 ms, total: 610 ms
Wall time: 606 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fixed <span class="op">=</span> gpd.GeoDataFrame(fixed, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 71.8 ms, sys: 61.1 ms, total: 133 ms
Wall time: 131 ms</code></pre>
</div>
</div>
</section>
<section id="validate-aoi-and-data-geometries" class="level3">
<h3 class="anchored" data-anchor-id="validate-aoi-and-data-geometries">Validate AOI and Data Geometries</h3>
<p>In order to prevent more headaches as we process and analyze geospatial datasets down the line, it is prudent to check that our datasets have valid geometries.</p>
<p>We can use the <code>geowrangler2.validation</code> module to check as well fix these problems.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geowrangler2.validation <span class="im">import</span> GeometryValidation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="validate-aoi" class="level4">
<h4 class="anchored" data-anchor-id="validate-aoi">Validate AOI</h4>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>admin3_gvm <span class="op">=</span> GeometryValidation(admin3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>valid_admin3 <span class="op">=</span> admin3_gvm.validate_all()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 306 ms, sys: 1.56 ms, total: 308 ms
Wall time: 306 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>valid_admin3.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">ADM3_EN</th>
<th data-quarto-table-cell-role="th">ADM3_PCODE</th>
<th data-quarto-table-cell-role="th">ADM3_REF</th>
<th data-quarto-table-cell-role="th">ADM3ALT1EN</th>
<th data-quarto-table-cell-role="th">ADM3ALT2EN</th>
<th data-quarto-table-cell-role="th">ADM2_EN</th>
<th data-quarto-table-cell-role="th">ADM2_PCODE</th>
<th data-quarto-table-cell-role="th">ADM1_EN</th>
<th data-quarto-table-cell-role="th">ADM1_PCODE</th>
<th data-quarto-table-cell-role="th">ADM0_EN</th>
<th data-quarto-table-cell-role="th">ADM0_PCODE</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">validOn</th>
<th data-quarto-table-cell-role="th">validTo</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">is_not_null</th>
<th data-quarto-table-cell-role="th">is_not_self_intersecting</th>
<th data-quarto-table-cell-role="th">is_oriented_properly</th>
<th data-quarto-table-cell-role="th">is_within_crs_bounds</th>
<th data-quarto-table-cell-role="th">area_is_not_zero</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">211</td>
<td>0.037803</td>
<td>0.000056</td>
<td>Binondo</td>
<td>PH133902000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, City of Manila, First District</td>
<td>PH133900000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((120.97738 14.60226, 120.97765 14.602...</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">308</td>
<td>0.692758</td>
<td>0.004468</td>
<td>Caloocan City</td>
<td>PH137501000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, Third District</td>
<td>PH137500000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>MULTIPOLYGON (((121.01856 14.69176, 121.01846 ...</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">395</td>
<td>0.362306</td>
<td>0.002745</td>
<td>City of Las Piñas</td>
<td>PH137601000</td>
<td>City of Las Pinas</td>
<td>None</td>
<td>None</td>
<td>NCR, Fourth District</td>
<td>PH137600000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>MULTIPOLYGON (((120.98122 14.48720, 120.98077 ...</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>0.260317</td>
<td>0.002094</td>
<td>City of Makati</td>
<td>PH137602000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, Fourth District</td>
<td>PH137600000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((121.03468 14.56725, 121.03416 14.567...</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">399</td>
<td>0.262034</td>
<td>0.001323</td>
<td>City of Malabon</td>
<td>PH137502000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, Third District</td>
<td>PH137500000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((120.92733 14.70265, 120.92690 14.702...</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="45">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>valid_cols <span class="op">=</span> [</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"is_oriented_properly"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"is_not_null"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"is_not_self_intersecting"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"is_within_crs_bounds"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"area_is_not_zero"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>[valid_admin3[col].value_counts() <span class="cf">for</span> col <span class="kw">in</span> valid_cols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>[False    30
 Name: is_oriented_properly, dtype: int64,
 True    30
 Name: is_not_null, dtype: int64,
 True    30
 Name: is_not_self_intersecting, dtype: int64,
 True    30
 Name: is_within_crs_bounds, dtype: int64,
 True    30
 Name: area_is_not_zero, dtype: int64]</code></pre>
</div>
</div>
<p>So the admin areas have their geometry <em>improperly oriented</em> (i.e.&nbsp;layed out in a counter clockwise direction instead of clockwise direction) and this has been fixed, but passes all the other default validations.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>valid_admin3.drop(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>valid_cols,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    inplace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="validate-data-geometries" class="level4">
<h4 class="anchored" data-anchor-id="validate-data-geometries">Validate Data Geometries</h4>
<p>Before validating, let’s filter the data to only those intersecting our AOI because we don’t need to check all the data from around the world when we’re only interested in our AOI.</p>
<p>Before we validate, we need to create the spatial indexes for both the AOI and data geometries. Generating the spatial indexes of the data geometries can take a minute or two due to the size of the data and their geometries.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>valid_admin3.geometry.sindex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.12 ms, sys: 541 µs, total: 1.66 ms
Wall time: 1.61 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>&lt;geopandas.sindex.PyGEOSSTRTreeIndex at 0x7f6e434b17f0&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fixed.geometry.sindex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 6.12 s, sys: 4.01 s, total: 10.1 s
Wall time: 10.1 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>&lt;geopandas.sindex.PyGEOSSTRTreeIndex at 0x7f6e434b1880&gt;</code></pre>
</div>
</div>
<p>Lets now filter the data (<code>filtered_fixed</code>).</p>
<p>Filtering the data using a spatial join can also take a minute or two.</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>filtered_fixed <span class="op">=</span> fixed.sjoin(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    valid_admin3[[<span class="st">"geometry"</span>]], how<span class="op">=</span><span class="st">"inner"</span>, predicate<span class="op">=</span><span class="st">"intersects"</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.97 s, sys: 688 ms, total: 2.66 s
Wall time: 2.67 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>filtered_fixed.drop(columns<span class="op">=</span>[<span class="st">"index_right"</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fixed_gvm <span class="op">=</span> GeometryValidation(filtered_fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>valid_fixed <span class="op">=</span> fixed_gvm.validate_all()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 676 ms, sys: 0 ns, total: 676 ms
Wall time: 673 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>[valid_fixed[col].value_counts() <span class="cf">for</span> col <span class="kw">in</span> valid_cols]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.96 ms, sys: 961 µs, total: 2.92 ms
Wall time: 2.28 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>[False    2300
 Name: is_oriented_properly, dtype: int64,
 True    2300
 Name: is_not_null, dtype: int64,
 True    2300
 Name: is_not_self_intersecting, dtype: int64,
 True    2300
 Name: is_within_crs_bounds, dtype: int64,
 True    2300
 Name: area_is_not_zero, dtype: int64]</code></pre>
</div>
</div>
<p>Again the data geometries have an improperly oriented geometry and have been fixed by the validator</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>valid_fixed.drop(columns<span class="op">=</span>valid_cols, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>filtered_fixed <span class="op">=</span> valid_fixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fixed-ookla-admin3-ncr-2020q2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">filtered fixed ookla data</figcaption>
</figure>
</div>
</section>
</section>
<section id="generate-zonal-stats" class="level3">
<h3 class="anchored" data-anchor-id="generate-zonal-stats">Generate Zonal Stats</h3>
<p>Lets now generate the zonal stats – the statistics of the data we are interested in.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>filtered_fixed.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">quadkey</th>
<th data-quarto-table-cell-role="th">avg_d_kbps</th>
<th data-quarto-table-cell-role="th">avg_u_kbps</th>
<th data-quarto-table-cell-role="th">avg_lat_ms</th>
<th data-quarto-table-cell-role="th">tests</th>
<th data-quarto-table-cell-role="th">devices</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">5646006</td>
<td>1323030313311323</td>
<td>43565</td>
<td>47889</td>
<td>8</td>
<td>93</td>
<td>23</td>
<td>POLYGON ((120.92102 14.73770, 120.92102 14.732...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5646008</td>
<td>1323030313311332</td>
<td>72579</td>
<td>91717</td>
<td>11</td>
<td>149</td>
<td>36</td>
<td>POLYGON ((120.92651 14.73770, 120.92651 14.732...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5646009</td>
<td>1323030313311333</td>
<td>52572</td>
<td>67337</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>POLYGON ((120.93201 14.73770, 120.93201 14.732...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5646018</td>
<td>1323030313313110</td>
<td>63548</td>
<td>77538</td>
<td>14</td>
<td>601</td>
<td>69</td>
<td>POLYGON ((120.92651 14.73239, 120.92651 14.727...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5646019</td>
<td>1323030313313111</td>
<td>105903</td>
<td>103874</td>
<td>13</td>
<td>115</td>
<td>22</td>
<td>POLYGON ((120.93201 14.73239, 120.93201 14.727...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(filtered_fixed.columns.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>['quadkey',
 'avg_d_kbps',
 'avg_u_kbps',
 'avg_lat_ms',
 'tests',
 'devices',
 'geometry']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(filtered_fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>2300</code></pre>
</div>
</div>
<p>Convert to planar CRS (since we are computing areas)</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>valid_admin3 <span class="op">=</span> valid_admin3.to_crs(<span class="st">"EPSG:3857"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 38.6 ms, sys: 0 ns, total: 38.6 ms
Wall time: 37.2 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>filtered_fixed <span class="op">=</span> filtered_fixed.to_crs(<span class="st">"EPSG:3857"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 23.3 ms, sys: 1.52 ms, total: 24.8 ms
Wall time: 23.4 ms</code></pre>
</div>
</div>
<p>Lets save the files so we can retrieve them as necessary without having to reprocess them again.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>valid_admin3.to_file(<span class="st">"../data/valid_admin3.geojson"</span>, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 539 ms, sys: 37.6 ms, total: 577 ms
Wall time: 574 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>filtered_fixed.to_file(<span class="st">"../data/filtered_fixed.geojson"</span>, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 583 ms, sys: 38.6 ms, total: 622 ms
Wall time: 620 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%time</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># valid_admin3 = gpd.read_file("../data/valid_admin3.geojson")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %%time</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filtered_fixed = gpd.read_file("../data/filtered_fixed.geojson")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We want the following statistics - <code>mean</code> (aka average), <code>min</code> (minimum), <code>max</code> (maximum) and the standard deviation (<code>std</code>) for the 3 data columns that ookla provides - average download speed (<code>avg_d_kbps</code>), average upload speed (<code>avg_u_kbps</code>) and average latency in milliseconds (<code>avg_lat_ms</code>)</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>funcs <span class="op">=</span> [<span class="st">"mean"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"std"</span>]</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">"avg_d_kbps"</span>, <span class="st">"avg_u_kbps"</span>, <span class="st">"avg_lat_ms"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>aggregations <span class="op">=</span> [<span class="bu">dict</span>(func<span class="op">=</span>funcs, column<span class="op">=</span>c) <span class="cf">for</span> c <span class="kw">in</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the aggregations to be performed for each data column</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>aggregations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>[{'func': ['mean', 'min', 'max', 'std'], 'column': 'avg_d_kbps'},
 {'func': ['mean', 'min', 'max', 'std'], 'column': 'avg_u_kbps'},
 {'func': ['mean', 'min', 'max', 'std'], 'column': 'avg_lat_ms'}]</code></pre>
</div>
</div>
<p>The output columns use the default <code>{column}_{func}</code> format if not explicitly specified.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>aoi <span class="op">=</span> azs.create_area_zonal_stats(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    valid_admin3, filtered_fixed, aggregations<span class="op">=</span>aggregations</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 3.74 s, sys: 0 ns, total: 3.74 s
Wall time: 3.73 s</code></pre>
</div>
</div>
</section>
<section id="analyze-zonal-stats" class="level3">
<h3 class="anchored" data-anchor-id="analyze-zonal-stats">Analyze Zonal Stats</h3>
<p>These are the results - the same dataframe as the original, with the addition of zonal statistics we specified as the aggregations.</p>
<div class="cell" data-tags="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>aoi.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape_Area</th>
<th data-quarto-table-cell-role="th">ADM3_EN</th>
<th data-quarto-table-cell-role="th">ADM3_PCODE</th>
<th data-quarto-table-cell-role="th">ADM3_REF</th>
<th data-quarto-table-cell-role="th">ADM3ALT1EN</th>
<th data-quarto-table-cell-role="th">ADM3ALT2EN</th>
<th data-quarto-table-cell-role="th">ADM2_EN</th>
<th data-quarto-table-cell-role="th">ADM2_PCODE</th>
<th data-quarto-table-cell-role="th">ADM1_EN</th>
<th data-quarto-table-cell-role="th">ADM1_PCODE</th>
<th data-quarto-table-cell-role="th">ADM0_EN</th>
<th data-quarto-table-cell-role="th">ADM0_PCODE</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">validOn</th>
<th data-quarto-table-cell-role="th">validTo</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">intersect_area_sum</th>
<th data-quarto-table-cell-role="th">avg_d_kbps_mean</th>
<th data-quarto-table-cell-role="th">avg_d_kbps_min</th>
<th data-quarto-table-cell-role="th">avg_d_kbps_max</th>
<th data-quarto-table-cell-role="th">avg_d_kbps_std</th>
<th data-quarto-table-cell-role="th">avg_u_kbps_mean</th>
<th data-quarto-table-cell-role="th">avg_u_kbps_min</th>
<th data-quarto-table-cell-role="th">avg_u_kbps_max</th>
<th data-quarto-table-cell-role="th">avg_u_kbps_std</th>
<th data-quarto-table-cell-role="th">avg_lat_ms_mean</th>
<th data-quarto-table-cell-role="th">avg_lat_ms_min</th>
<th data-quarto-table-cell-role="th">avg_lat_ms_max</th>
<th data-quarto-table-cell-role="th">avg_lat_ms_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">211</td>
<td>0.037803</td>
<td>0.000056</td>
<td>Binondo</td>
<td>PH133902000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, City of Manila, First District</td>
<td>PH133900000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((13467140.279 1643403.808, 13467170.0...</td>
<td>2.330890e+06</td>
<td>15125.377199</td>
<td>0.0</td>
<td>97827</td>
<td>4141.081774</td>
<td>12152.916247</td>
<td>0.0</td>
<td>80923</td>
<td>5625.791089</td>
<td>1.228832</td>
<td>0.0</td>
<td>8</td>
<td>0.923381</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">308</td>
<td>0.692758</td>
<td>0.004468</td>
<td>Caloocan City</td>
<td>PH137501000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, Third District</td>
<td>PH137500000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>MULTIPOLYGON (((13471724.654 1653701.565, 1347...</td>
<td>7.425998e+07</td>
<td>309.956521</td>
<td>0.0</td>
<td>123236</td>
<td>15346.775252</td>
<td>307.716950</td>
<td>0.0</td>
<td>117885</td>
<td>15118.576034</td>
<td>0.035243</td>
<td>0.0</td>
<td>59</td>
<td>6.147227</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">395</td>
<td>0.362306</td>
<td>0.002745</td>
<td>City of Las Piñas</td>
<td>PH137601000</td>
<td>City of Las Pinas</td>
<td>None</td>
<td>None</td>
<td>NCR, Fourth District</td>
<td>PH137600000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>MULTIPOLYGON (((13467568.063 1630171.435, 1346...</td>
<td>4.080667e+07</td>
<td>649.603501</td>
<td>0.0</td>
<td>175810</td>
<td>22328.120899</td>
<td>555.324817</td>
<td>0.0</td>
<td>136167</td>
<td>19944.226971</td>
<td>0.045298</td>
<td>0.0</td>
<td>146</td>
<td>11.110505</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">398</td>
<td>0.260317</td>
<td>0.002094</td>
<td>City of Makati</td>
<td>PH137602000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, Fourth District</td>
<td>PH137600000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((13473518.917 1639376.906, 13473461.1...</td>
<td>3.840895e+07</td>
<td>765.462383</td>
<td>0.0</td>
<td>159496</td>
<td>16771.721664</td>
<td>663.200995</td>
<td>0.0</td>
<td>144939</td>
<td>17818.361374</td>
<td>0.091436</td>
<td>0.0</td>
<td>25</td>
<td>5.288884</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">399</td>
<td>0.262034</td>
<td>0.001323</td>
<td>City of Malabon</td>
<td>PH137502000</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>NCR, Third District</td>
<td>PH137500000</td>
<td>National Capital Region</td>
<td>PH130000000</td>
<td>Philippines (the)</td>
<td>PH</td>
<td>2016-06-30</td>
<td>2020-05-29</td>
<td>None</td>
<td>POLYGON ((13461569.031 1654955.161, 13461520.7...</td>
<td>2.583556e+07</td>
<td>1006.838781</td>
<td>0.0</td>
<td>119622</td>
<td>13444.542392</td>
<td>933.345049</td>
<td>0.0</td>
<td>130002</td>
<td>14309.585589</td>
<td>0.096779</td>
<td>0.0</td>
<td>17</td>
<td>2.893162</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Lets save the results</p>
<div class="cell" data-tags="[]" data-execution_count="71">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>aoi.to_file(<span class="st">"../data/admin3_internet_aoi.geojson"</span>, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 415 ms, sys: 12.3 ms, total: 428 ms
Wall time: 424 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(aoi.columns.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>['Shape_Leng',
 'Shape_Area',
 'ADM3_EN',
 'ADM3_PCODE',
 'ADM3_REF',
 'ADM3ALT1EN',
 'ADM3ALT2EN',
 'ADM2_EN',
 'ADM2_PCODE',
 'ADM1_EN',
 'ADM1_PCODE',
 'ADM0_EN',
 'ADM0_PCODE',
 'date',
 'validOn',
 'validTo',
 'geometry',
 'intersect_area_sum',
 'avg_d_kbps_mean',
 'avg_d_kbps_min',
 'avg_d_kbps_max',
 'avg_d_kbps_std',
 'avg_u_kbps_mean',
 'avg_u_kbps_min',
 'avg_u_kbps_max',
 'avg_u_kbps_std',
 'avg_lat_ms_mean',
 'avg_lat_ms_min',
 'avg_lat_ms_max',
 'avg_lat_ms_std']</code></pre>
</div>
</div>
<p>Let’s sort the different admin level 3 areas (cities/municipalities/district) by average download speed (<code>avg_d_kbps_mean</code>) in descending order</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>fastest_mean_download <span class="op">=</span> aoi.sort_values(<span class="st">"avg_d_kbps_mean"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 3.72 ms, sys: 0 ns, total: 3.72 ms
Wall time: 3.16 ms</code></pre>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(fastest_mean_download)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>30</code></pre>
</div>
</div>
<p>So according the latest ookla data (as of this writing) the district/town/province within the NCR Region with the fastest average download speed is <strong>Binondo</strong>!! :)</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fastest_mean_download.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>Shape_Leng                                                     0.037803
Shape_Area                                                     0.000056
ADM3_EN                                                         Binondo
ADM3_PCODE                                                  PH133902000
ADM3_REF                                                           None
ADM3ALT1EN                                                         None
ADM3ALT2EN                                                         None
ADM2_EN                             NCR, City of Manila, First District
ADM2_PCODE                                                  PH133900000
ADM1_EN                                         National Capital Region
ADM1_PCODE                                                  PH130000000
ADM0_EN                                               Philippines (the)
ADM0_PCODE                                                           PH
date                                                         2016-06-30
validOn                                                      2020-05-29
validTo                                                            None
geometry              POLYGON ((13467140.2793258 1643403.80801774, 1...
intersect_area_sum                                       2330890.174196
avg_d_kbps_mean                                            15125.377199
avg_d_kbps_min                                                      0.0
avg_d_kbps_max                                                    97827
avg_d_kbps_std                                              4141.081774
avg_u_kbps_mean                                            12152.916247
avg_u_kbps_min                                                      0.0
avg_u_kbps_max                                                    80923
avg_u_kbps_std                                              5625.791089
avg_lat_ms_mean                                                1.228832
avg_lat_ms_min                                                      0.0
avg_lat_ms_max                                                        8
avg_lat_ms_std                                                 0.923381
Name: 211, dtype: object</code></pre>
</div>
</div>
<p>While the district/city/municipality within the NCR Regions with the slowest average download speed is <strong>Quezon City</strong>!!!</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>fastest_mean_download.iloc[<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>Shape_Leng                                                     0.773902
Shape_Area                                                      0.01363
ADM3_EN                                                     Quezon City
ADM3_PCODE                                                  PH137404000
ADM3_REF                                                           None
ADM3ALT1EN                                                         None
ADM3ALT2EN                                                         None
ADM2_EN                                            NCR, Second District
ADM2_PCODE                                                  PH137400000
ADM1_EN                                         National Capital Region
ADM1_PCODE                                                  PH130000000
ADM0_EN                                               Philippines (the)
ADM0_PCODE                                                           PH
date                                                         2016-06-30
validOn                                                      2020-05-29
validTo                                                            None
geometry              POLYGON ((13484683.37714301 1663482.482347114,...
intersect_area_sum                                      174544789.29521
avg_d_kbps_mean                                              145.111131
avg_d_kbps_min                                                      0.0
avg_d_kbps_max                                                   269544
avg_d_kbps_std                                             20232.269854
avg_u_kbps_mean                                              133.033955
avg_u_kbps_min                                                      0.0
avg_u_kbps_max                                                   260425
avg_u_kbps_std                                             20141.871761
avg_lat_ms_mean                                                0.011798
avg_lat_ms_min                                                      0.0
avg_lat_ms_max                                                       29
avg_lat_ms_std                                                  2.90016
Name: 1191, dtype: object</code></pre>
</div>
</div>
<p>The top 5 fastest areas are</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>fastest_mean_download[[<span class="st">"ADM3_EN"</span>, <span class="st">"ADM2_EN"</span>, <span class="st">"avg_d_kbps_mean"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADM3_EN</th>
<th data-quarto-table-cell-role="th">ADM2_EN</th>
<th data-quarto-table-cell-role="th">avg_d_kbps_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">211</td>
<td>Binondo</td>
<td>NCR, City of Manila, First District</td>
<td>15125.377199</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1343</td>
<td>San Nicolas</td>
<td>NCR, City of Manila, First District</td>
<td>10897.783018</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1192</td>
<td>Quiapo</td>
<td>NCR, City of Manila, First District</td>
<td>9799.121085</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1336</td>
<td>San Miguel</td>
<td>NCR, City of Manila, First District</td>
<td>8708.791412</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1112</td>
<td>Pateros</td>
<td>NCR, Fourth District</td>
<td>7581.975774</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The top 5 slowest areas are</p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>fastest_mean_download[[<span class="st">"ADM3_EN"</span>, <span class="st">"ADM2_EN"</span>, <span class="st">"avg_d_kbps_mean"</span>]].tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADM3_EN</th>
<th data-quarto-table-cell-role="th">ADM2_EN</th>
<th data-quarto-table-cell-role="th">avg_d_kbps_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1521</td>
<td>Taguig City</td>
<td>NCR, Fourth District</td>
<td>531.559943</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">411</td>
<td>City of Parañaque</td>
<td>NCR, Fourth District</td>
<td>470.491966</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">436</td>
<td>City of Valenzuela</td>
<td>NCR, Third District</td>
<td>420.083766</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">308</td>
<td>Caloocan City</td>
<td>NCR, Third District</td>
<td>309.956521</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1191</td>
<td>Quezon City</td>
<td>NCR, Second District</td>
<td>145.111131</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes()</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fastest_mean_download.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"blue"</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fastest_mean_download.iloc[:<span class="dv">1</span>].plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"red"</span>, edgecolor<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fastest_mean_download.iloc[<span class="dv">29</span>:].plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"green"</span>, edgecolor<span class="op">=</span><span class="st">"green"</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fastest_mean_download.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">"avg_d_kbps_mean"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="overview.usecase_ookla_files/figure-html/cell-79-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fastest-fixed-ookla-by-adm3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">fastest fixed ookla by adm3</figcaption>
</figure>
</div>
<p>So now, we’ve answered the question of where the fastest/slowest internet speeds are for the National Capital Region (NCR)</p>
</section>
<section id="additional-exercises" class="level3">
<h3 class="anchored" data-anchor-id="additional-exercises">Additional Exercises</h3>
<p>You can further experiment and try out other exercises to explore ookla data, or even try it out using a different country using a different geodataset from the Humanitarian Data Exchange site.</p>
<p>The following are more exercises you can try:</p>
<ul>
<li>Repeat the same process to find the fastest and slowest <strong>mobile</strong> internet speeds</li>
<li>Repeat the same process for a different REGION_FILTER</li>
<li>Aggregate by adm2 level instead of adm3</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://thinkingmachin.es">Copyright 2023 onwards, Thinking Machines Data Science Inc.</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center"><a href="https://thinkingmachin.es"><img src="images/company_logo_sm.png" class="img-fluid" alt="Thinking Machines Data Science Inc." width="65"></a></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/butchtm/geowrangler2">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>